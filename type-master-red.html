<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Type Master - Coders' Arena</title>
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&display=swap');
        .orbitron-font {
            font-family: 'Orbitron', sans-serif;
        }
        .typing-area {
            min-height: 200px;
            font-size: 1.2rem;
            line-height: 1.8;
        }
        .correct {
            color: #4ade80;
        }
        .incorrect {
            color: #f87171;
            text-decoration: underline;
        }
        .current {
            background-color: rgba(59, 130, 246, 0.2);
        }
        .stats-display {
            font-size: 1.5rem;
            font-weight: 700;
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen">
    <!-- Header -->
    <header class="bg-gray-800 border-b border-gray-700">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center">
                <h1 class="orbitron-font text-2xl font-bold">Coders' Arena</h1>
                <span class="ml-4 px-3 py-1 bg-red-900 text-red-300 rounded-full text-sm">Team Red</span>
            </div>
            <div class="flex items-center space-x-4">
                <button id="back-btn" class="px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg transition-colors">
                    Back to Dashboard
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <div class="max-w-4xl mx-auto">
            <div class="text-center mb-10">
                <h2 class="orbitron-font text-3xl font-bold mb-2">Type Master Challenge</h2>
                <p class="text-gray-400">
                    Type the text below as accurately and quickly as possible. You need 90% accuracy to pass.
                </p>
            </div>

            <!-- Stats -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                <div class="bg-gray-800 rounded-xl p-4 text-center">
                    <div class="stats-display" id="wpm">0</div>
                    <div class="text-gray-400 text-sm">WPM</div>
                </div>
                <div class="bg-gray-800 rounded-xl p-4 text-center">
                    <div class="stats-display" id="accuracy">100%</div>
                    <div class="text-gray-400 text-sm">Accuracy</div>
                </div>
                <div class="bg-gray-800 rounded-xl p-4 text-center">
                    <div class="stats-display" id="time">0s</div>
                    <div class="text-gray-400 text-sm">Time</div>
                </div>
                <div class="bg-gray-800 rounded-xl p-4 text-center">
                    <div class="stats-display" id="errors">0</div>
                    <div class="text-gray-400 text-sm">Errors</div>
                </div>
            </div>

            <!-- Text to type -->
            <div class="bg-gray-800 rounded-2xl p-6 mb-8">
                <div id="text-to-type" class="typing-area mb-6 p-4 rounded-lg bg-gray-700">
                    <!-- Text will be inserted here dynamically -->
                </div>
                <textarea 
                    id="typing-input" 
                    class="w-full p-4 bg-gray-700 border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" 
                    placeholder="Start typing here..." 
                    rows="4"
                ></textarea>
            </div>

            <!-- Controls -->
            <div class="flex justify-center space-x-4">
                <button id="start-btn" class="px-6 py-3 bg-green-600 hover:bg-green-700 rounded-lg font-semibold transition-colors">
                    Start Challenge
                </button>
                <button id="submit-btn" class="px-6 py-3 bg-blue-600 hover:bg-blue-700 rounded-lg font-semibold transition-colors hidden">
                    Submit Challenge
                </button>
            </div>

            <!-- Result -->
            <div id="result" class="mt-8 text-center hidden">
                <div class="text-2xl mb-4">Challenge Complete!</div>
                <div id="result-message" class="text-xl"></div>
            </div>
        </div>
    </main>

    <script>
        // Initialize Feather Icons
        feather.replace();

        // Sample texts for typing challenge
        const sampleTexts = [
            "Technology has changed the way humans live, work, and connect. From the early days of simple machines to the modern world of smart devices, progress has never slowed down. Every year, new systems rise, and old ones fade away. The internet has turned the globe into one large network, linking people and data in ways once thought impossible. Artificial intelligence now drives cars, recommends music, and even writes code. Cloud servers hold massive amounts of information, ready to be accessed from anywhere. Automation saves time and reduces errors, but it also raises questions about jobs and ethics. Digital security is more important than ever, as every online action leaves a trace. With each new update or gadget, life becomes faster and more connected. Yet behind every screen, it is still humans who guide the code, shape the algorithms, and decide how far innovation should go.",
        ];

        // DOM elements
        const textToType = document.getElementById('text-to-type');
        const typingInput = document.getElementById('typing-input');
        const startBtn = document.getElementById('start-btn');
        const submitBtn = document.getElementById('submit-btn');
        const result = document.getElementById('result');
        const resultMessage = document.getElementById('result-message');
        const wpmDisplay = document.getElementById('wpm');
        const accuracyDisplay = document.getElementById('accuracy');
        const timeDisplay = document.getElementById('time');
        const errorsDisplay = document.getElementById('errors');

        // Game variables
        let startTime;
        let timerInterval;
        let currentText = "";
        let isStarted = false;
        let errorCount = 0;

        // Initialize game
        function initGame() {
            // Select random text
            currentText = sampleTexts[Math.floor(Math.random() * sampleTexts.length)];
            
            // Display text with spans for each character
            textToType.innerHTML = "";
            for (let i = 0; i < currentText.length; i++) {
                const charSpan = document.createElement('span');
                charSpan.innerText = currentText[i];
                textToType.appendChild(charSpan);
            }
            
            // Reset input and displays
            typingInput.value = "";
            typingInput.disabled = true;
            result.classList.add('hidden');
            updateStats(0, 100, 0, 0);
            errorCount = 0;
            isStarted = false;
            submitBtn.classList.add('hidden');
        }

        // Update stats display
        function updateStats(wpm, accuracy, time, errors) {
            wpmDisplay.textContent = wpm;
            accuracyDisplay.textContent = accuracy + '%';
            timeDisplay.textContent = time + 's';
            errorsDisplay.textContent = errors;
        }

        // Start challenge
        function startChallenge() {
            if (!isStarted) {
                isStarted = true;
                startTime = new Date();
                typingInput.disabled = false;
                typingInput.focus();
                startBtn.textContent = "Restart";
                
                // Start timer
                clearInterval(timerInterval);
                timerInterval = setInterval(updateTimer, 100);
            } else {
                // Restart
                resetChallenge();
                startChallenge();
            }
            // Ensure submit button is hidden at start
            submitBtn.classList.add('hidden');
        }

        // Reset challenge
        function resetChallenge() {
            clearInterval(timerInterval);
            initGame();
        }

        // Update timer and stats
        function updateTimer() {
            if (!isStarted) return;
            
            const currentTime = new Date();
            const elapsedTime = (currentTime - startTime) / 1000; // in seconds
            const minutes = elapsedTime / 60;
            
            // Calculate WPM (words per minute)
            const typedText = typingInput.value;
            const words = typedText.trim().split(/\s+/).filter(word => word.length > 0).length;
            const wpm = minutes > 0 ? Math.round(words / minutes) : 0;
            
            // Calculate accuracy
            let correctChars = 0;
            for (let i = 0; i < typedText.length; i++) {
                if (i < currentText.length && typedText[i] === currentText[i]) {
                    correctChars++;
                }
            }
            const accuracy = typedText.length > 0 ? Math.round((correctChars / typedText.length) * 100) : 100;
            
            updateStats(wpm, accuracy, Math.round(elapsedTime), errorCount);
            
            // Show/hide submit button based on conditions: accuracy >= 90% and all text typed
            if (accuracy >= 90 && typedText.length === currentText.length) {
                submitBtn.classList.remove('hidden');
            } else {
                submitBtn.classList.add('hidden');
            }
            
            // Check if challenge is complete
            if (typedText.length === currentText.length) {
                if (accuracy >= 90) {
                    // Only show success message if submit fails - otherwise submit button handles it
                    // The submit button will now be visible at this point
                } else {
                    // If accuracy is less than 90%, finish the challenge with failure message
                    finishChallenge(accuracy);
                }
            }
        }

        // Finish challenge
        function finishChallenge(accuracy) {
            clearInterval(timerInterval);
            typingInput.disabled = true;
            
            // Only show failure message if accuracy is below 90%
            // Success case is handled by submit button
            if (accuracy < 90) {
                resultMessage.innerHTML = `<span class="text-red-500">Try Again!</span> You need 90% accuracy. Your accuracy: ${accuracy}%`;
                result.classList.remove('hidden');
            }
        }

        // Handle typing input
        typingInput.addEventListener('input', function() {
            const typedText = typingInput.value;
            const characters = textToType.querySelectorAll('span');
            
            // Reset classes
            characters.forEach(char => {
                char.classList.remove('correct', 'incorrect', 'current');
            });
            
            // Update character highlighting
            errorCount = 0;
            for (let i = 0; i < characters.length; i++) {
                if (i < typedText.length) {
                    if (typedText[i] === currentText[i]) {
                        characters[i].classList.add('correct');
                    } else {
                        characters[i].classList.add('incorrect');
                        errorCount++;
                    }
                } else if (i === typedText.length) {
                    characters[i].classList.add('current');
                }
            }
            
            updateTimer();
        });

        // Event listeners
        startBtn.addEventListener('click', startChallenge);
        
        // Submit button functionality
        submitBtn.addEventListener('click', function() {
            // When submit is clicked, show success message and finish challenge
            const currentAccuracy = parseInt(accuracyDisplay.textContent);
            resultMessage.innerHTML = `<span class="text-green-500">Challenge Submitted!</span> Great job completing the challenge with ${currentAccuracy}% accuracy!`;
            result.classList.remove('hidden');
            typingInput.disabled = true;
            clearInterval(timerInterval);
        });
        
        // Back to dashboard button functionality
        const backBtn = document.getElementById('back-btn');
        backBtn.addEventListener('click', function() {
            // Navigate back to the team dashboard
            // For now, redirecting to a generic dashboard page
            window.location.href = 'team-red-dashboard.html'; // Redirect to main dashboard
        });

        // Initialize game on load
        initGame();
    </script>
</body>
</html>